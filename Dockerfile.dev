# Development Dockerfile with hot reloading
FROM node:20-alpine AS frontend-dev

WORKDIR /app/frontend

# Install frontend dependencies
COPY source/client2/package*.json ./
RUN npm install

# Copy frontend source code
COPY source/client2/ ./

# Expose Vite dev server port
EXPOSE 5173

# Start frontend development server with hot reload
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]

# Backend development stage
FROM gradle:jdk21 AS backend-dev

WORKDIR /app

# Copy Gradle files first for better caching
COPY source/server/gradle/ ./gradle/
COPY source/server/gradlew ./
COPY source/server/settings.gradle ./
COPY source/server/build.gradle ./

# Copy source code
COPY source/server/src/ ./src/

# Expose backend port
EXPOSE 8080

# Start backend in development mode with hot reload
CMD ["./gradlew", "bootRun", "--continuous"]